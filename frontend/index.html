<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      font-size: 2em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–∞—Ç–∏ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }
    
    .modal-content h2 {
      margin-bottom: 20px;
      color: #333;
    }
    
    .modal-content input[type="date"] {
      width: 100%;
      padding: 15px;
      font-size: 1.2em;
      border: 2px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .modal-content button {
      background: #667eea;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
    }
    
    .modal-content button:hover {
      background: #5568d3;
    }
    
    /* –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ */
    #fridge-selector {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .fridge-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .fridge-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .fridge-card.selected {
      background: #667eea;
      color: white;
    }
    
    .fridge-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }
    
    .fridge-number {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .fridge-count {
      font-size: 0.9em;
      opacity: 0.7;
    }
    
    /* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ */
    #product-list {
      display: none;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    #product-list.active {
      display: block;
    }
    
    .back-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      margin-bottom: 20px;
      transition: background 0.3s;
    }
    
    .back-btn:hover {
      background: #5568d3;
    }
    
    /* –ü–æ—à—É–∫ */
    .search-box {
      margin: 20px 0;
      position: sticky;
      top: 0;
      background: white;
      padding: 10px 0;
      z-index: 100;
    }
    
    .search-input {
      width: 100%;
      padding: 15px 20px;
      font-size: 1.1em;
      border: 2px solid #ddd;
      border-radius: 10px;
      transition: border-color 0.3s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .search-stats {
      margin-top: 10px;
      color: #666;
      font-size: 0.9em;
    }
    
    .product-item {
      border-bottom: 1px solid #eee;
      padding: 20px 0;
      display: grid;
      grid-template-columns: 1fr auto 150px;
      gap: 20px;
      align-items: center;
      transition: background 0.3s;
    }
    
    .product-item.hidden {
      display: none;
    }
    
    .product-item.highlight {
      background: #fffbeb;
      padding: 20px 10px;
      border-radius: 8px;
    }
    
    .product-item:last-child {
      border-bottom: none;
    }
    
    .product-info h3 {
      font-size: 1.1em;
      margin-bottom: 5px;
      color: #333;
    }
    
    .product-info .category {
      font-size: 0.9em;
      color: #666;
      background: #f0f0f0;
      display: inline-block;
      padding: 3px 10px;
      border-radius: 5px;
      margin-right: 10px;
    }
    
    .product-info .type {
      font-size: 0.9em;
      color: #667eea;
      font-weight: 500;
    }
    
    .current-quantity {
      text-align: right;
      font-size: 0.9em;
      color: #666;
    }
    
    .quantity-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quantity-input input {
      width: 100px;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      text-align: center;
      transition: border-color 0.3s;
    }
    
    .quantity-input input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .quantity-input input.filled {
      border-color: #10b981;
      background: #f0fdf4;
    }
    
    .quantity-input span {
      color: #666;
      font-size: 0.9em;
    }
    
    .save-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 30px;
      width: 100%;
      transition: background 0.3s;
    }
    
    .save-btn:hover {
      background: #059669;
    }
    
    .save-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* –ü—Ä–æ–≥—Ä–µ—Å */
    .progress-bar {
      background: #f0f0f0;
      height: 8px;
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #667eea, #764ba2);
      height: 100%;
      transition: width 0.3s;
    }
    
    .message {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
      font-weight: 500;
    }
    
    .message.success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .message.error {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .message.warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: white;
      font-size: 1.2em;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –ø–æ–∑–∏—Ü—ñ–π */
    .unfilled-modal {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .unfilled-list {
      text-align: left;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .unfilled-item {
      padding: 10px;
      background: #fef3c7;
      margin: 5px 0;
      border-radius: 5px;
      border-left: 4px solid #f59e0b;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .modal-buttons button {
      flex: 1;
    }
    
    .btn-secondary {
      background: #6b7280 !important;
    }
    
    .btn-secondary:hover {
      background: #4b5563 !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ùÑÔ∏è –Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤</h1>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞—Ç–∏ -->
    <div id="date-modal" class="modal active">
      <div class="modal-content">
        <h2>üìÖ –î–∞—Ç–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó</h2>
        <p style="color: #666; margin-bottom: 20px;">–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó</p>
        <input type="date" id="inventory-date" />
        <button onclick="startInventory()">–ü–æ—á–∞—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—é</button>
      </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –ø–æ–∑–∏—Ü—ñ–π -->
    <div id="unfilled-modal" class="modal">
      <div class="modal-content unfilled-modal">
        <h2>‚ö†Ô∏è –ù–µ–∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó</h2>
        <p style="color: #666; margin-bottom: 20px;">
          –í–∏ –Ω–µ –∑–∞–ø–æ–≤–Ω–∏–ª–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è?
        </p>
        <div id="unfilled-list" class="unfilled-list"></div>
        <div class="modal-buttons">
          <button class="btn-secondary" onclick="closeUnfilledModal()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
          <button onclick="confirmSave()">–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É</button>
        </div>
      </div>
    </div>
    
    <div id="loading" class="loading">
      –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
    </div>
    
    <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ -->
    <div id="fridge-selector" style="display: none;"></div>
    
    <!-- –ï–∫—Ä–∞–Ω —Å–ø–∏—Å–∫—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ -->
    <div id="product-list">
      <button class="back-btn" onclick="showFridgeSelector()">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤</button>
      <h2 id="current-fridge-title"></h2>
      
      <!-- –ü–æ—à—É–∫ -->
      <div class="search-box">
        <input 
          type="text" 
          class="search-input" 
          id="search-input" 
          placeholder="üîç –ü–æ—à—É–∫ –ø—Ä–æ–¥—É–∫—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –∫–æ–∫–∞, –ø–∏–≤–æ, —Å–∞–ª–∞—Ç...)"
          oninput="filterProducts()"
        />
        <div class="search-stats" id="search-stats"></div>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div id="message"></div>
      <div id="products-container"></div>
      <button class="save-btn" onclick="saveCurrentFridge()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–ª–∏—à–∫–∏</button>
    </div>
  </div>

  <script>
    const API_URL = "https://inventory-duab.onrender.com";
    let allFridges = [];
    let currentFridge = null;
    let inventoryData = {}; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ
    let inventoryDate = null; // –î–∞—Ç–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó
    let currentProducts = []; // –ü–æ—Ç–æ—á–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    document.getElementById("inventory-date").valueAsDate = new Date();

    // –ü–æ—á–∞—Ç–æ–∫ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó –ø—ñ—Å–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞—Ç–∏
    function startInventory() {
      const dateInput = document.getElementById("inventory-date").value;
      if (!dateInput) {
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó");
        return;
      }
      
      inventoryDate = dateInput;
      document.getElementById("date-modal").classList.remove("active");
      loadData();
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    async function loadData() {
      try {
        const response = await fetch(`${API_URL}/api/inventory/products`);
        const data = await response.json();
        
        allFridges = data;
        
        document.getElementById("loading").style.display = "none";
        showFridgeSelector();
      } catch (error) {
        document.getElementById("loading").innerHTML = 
          `<div class="message error">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${error.message}</div>`;
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –µ–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤
    function showFridgeSelector() {
      document.getElementById("fridge-selector").style.display = "grid";
      document.getElementById("product-list").classList.remove("active");
      
      const selector = document.getElementById("fridge-selector");
      selector.innerHTML = "";
      
      allFridges.forEach(fridge => {
        const card = document.createElement("div");
        card.className = "fridge-card";
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
        const hasData = inventoryData[fridge.fridgeNumber] && 
                        inventoryData[fridge.fridgeNumber].some(p => p.quantity !== "");
        
        if (hasData) {
          card.classList.add("selected");
        }
        
        card.innerHTML = `
          <div class="fridge-icon">‚ùÑÔ∏è</div>
          <div class="fridge-number">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ${fridge.fridgeNumber}</div>
          <div class="fridge-count">${fridge.products.length} –ø–æ–∑–∏—Ü—ñ–π</div>
          ${hasData ? '<div style="margin-top: 10px;">‚úÖ –ó–∞–ø–æ–≤–Ω–µ–Ω–æ</div>' : ''}
        `;
        
        card.onclick = () => showProducts(fridge);
        selector.appendChild(card);
      });
      
      // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É "–ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å–µ"
      if (Object.keys(inventoryData).length > 0) {
        const saveAllBtn = document.createElement("button");
        saveAllBtn.className = "save-btn";
        saveAllBtn.textContent = "üíæ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—é –≤ Google Sheets";
        saveAllBtn.style.gridColumn = "1 / -1";
        saveAllBtn.onclick = checkAndSaveAll;
        selector.appendChild(saveAllBtn);
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
    function showProducts(fridge) {
      currentFridge = fridge;
      currentProducts = fridge.products;
      document.getElementById("fridge-selector").style.display = "none";
      document.getElementById("product-list").classList.add("active");
      document.getElementById("current-fridge-title").textContent = 
        `–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ${fridge.fridgeNumber}`;
      
      // –û—á–∏—â—É—î–º–æ –ø–æ—à—É–∫
      document.getElementById("search-input").value = "";
      
      const container = document.getElementById("products-container");
      container.innerHTML = "";
      
      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ —è–∫—â–æ —î
      const savedData = inventoryData[fridge.fridgeNumber] || [];
      
      fridge.products.forEach((product, index) => {
        const savedProduct = savedData.find(p => p.name === product.name);
        const quantity = savedProduct ? savedProduct.quantity : "";
        
        const item = document.createElement("div");
        item.className = "product-item";
        item.setAttribute("data-name", product.name.toLowerCase());
        item.setAttribute("data-category", product.category.toLowerCase());
        
        item.innerHTML = `
          <div class="product-info">
            <h3>${product.name}</h3>
            <span class="category">${product.category}</span>
            <span class="type">${product.type}</span>
          </div>
          <div class="current-quantity">
            ${product.currentQuantity ? `–ü–æ—Ç–æ—á–Ω–∏–π: ${product.currentQuantity}` : ''}
          </div>
          <div class="quantity-input">
            <input 
              type="number" 
              step="0.01" 
              min="0" 
              placeholder="0"
              value="${quantity}"
              data-product-name="${product.name}"
              class="${quantity !== '' ? 'filled' : ''}"
              oninput="updateProgress(); markAsFilled(this)"
            />
            <span>–∫–≥</span>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateProgress();
      updateSearchStats();
    }

    // –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–ª–µ —è–∫ –∑–∞–ø–æ–≤–Ω–µ–Ω–µ
    function markAsFilled(input) {
      if (input.value !== "") {
        input.classList.add("filled");
      } else {
        input.classList.remove("filled");
      }
    }

    // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
    function filterProducts() {
      const searchTerm = document.getElementById("search-input").value.toLowerCase();
      const items = document.querySelectorAll(".product-item");
      let visibleCount = 0;
      
      items.forEach(item => {
        const name = item.getAttribute("data-name");
        const category = item.getAttribute("data-category");
        
        if (name.includes(searchTerm) || category.includes(searchTerm)) {
          item.classList.remove("hidden");
          if (searchTerm !== "") {
            item.classList.add("highlight");
          } else {
            item.classList.remove("highlight");
          }
          visibleCount++;
        } else {
          item.classList.add("hidden");
          item.classList.remove("highlight");
        }
      });
      
      updateSearchStats(visibleCount, items.length);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—à—É–∫—É
    function updateSearchStats(visible, total) {
      const statsDiv = document.getElementById("search-stats");
      const searchTerm = document.getElementById("search-input").value;
      
      if (!total) {
        total = document.querySelectorAll(".product-item").length;
        visible = total;
      }
      
      if (searchTerm) {
        statsDiv.textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ: ${visible} –∑ ${total} –ø–æ–∑–∏—Ü—ñ–π`;
      } else {
        statsDiv.textContent = `–í—Å—å–æ–≥–æ –ø–æ–∑–∏—Ü—ñ–π: ${total}`;
      }
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
    function updateProgress() {
      const inputs = document.querySelectorAll("#products-container input");
      const filled = Array.from(inputs).filter(input => input.value !== "").length;
      const total = inputs.length;
      const percent = (filled / total) * 100;
      
      document.getElementById("progress-fill").style.width = percent + "%";
    }

    // –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
    function saveCurrentFridge() {
      const inputs = document.querySelectorAll("#products-container input");
      const products = [];
      
      inputs.forEach(input => {
        const quantity = input.value; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —è–∫ string, —â–æ–± –≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏ "" –≤—ñ–¥ "0"
        products.push({
          name: input.getAttribute("data-product-name"),
          quantity: quantity
        });
      });
      
      inventoryData[currentFridge.fridgeNumber] = products;
      
      const messageDiv = document.getElementById("message");
      messageDiv.className = "message success";
      messageDiv.textContent = "‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –ú–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ –∞–±–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å–µ.";
      
      setTimeout(() => {
        showFridgeSelector();
      }, 1500);
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –ø–æ–∑–∏—Ü—ñ–π –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º
    function checkAndSaveAll() {
      const unfilled = [];
      
      Object.keys(inventoryData).forEach(fridgeNum => {
        inventoryData[fridgeNum].forEach(product => {
          if (product.quantity === "") {
            unfilled.push({
              fridge: fridgeNum,
              name: product.name
            });
          }
        });
      });
      
      if (unfilled.length > 0) {
        showUnfilledModal(unfilled);
      } else {
        saveAllInventory();
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏
    function showUnfilledModal(unfilled) {
      const modal = document.getElementById("unfilled-modal");
      const list = document.getElementById("unfilled-list");
      
      list.innerHTML = "";
      
      unfilled.forEach(item => {
        const div = document.createElement("div");
        div.className = "unfilled-item";
        div.textContent = `–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ${item.fridge}: ${item.name}`;
        list.appendChild(div);
      });
      
      modal.classList.add("active");
    }

    // –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
    function closeUnfilledModal() {
      document.getElementById("unfilled-modal").classList.remove("active");
    }

    // –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑ –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏
    function confirmSave() {
      closeUnfilledModal();
      saveAllInventory();
    }

    // –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ –≤ Google Sheets
    async function saveAllInventory() {
      try {
        const fridgeArray = Object.keys(inventoryData).map(fridgeNumber => ({
          fridgeNumber,
          products: inventoryData[fridgeNumber].map(p => ({
            name: p.name,
            quantity: p.quantity === "" ? 0 : parseFloat(p.quantity) || 0
          }))
        }));
        
        const response = await fetch(`${API_URL}/api/inventory/save`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ 
            inventoryData: fridgeArray,
            inventoryDate: inventoryDate
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert(`‚úÖ ${result.message}\n\n–ê—Ä–∫—É—à: ${result.sheetName}`);
          // –û—á–∏—â–∞—î–º–æ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
          inventoryData = {};
          inventoryDate = null;
          // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞—Ç–∏ –¥–ª—è –Ω–æ–≤–æ—ó —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó
          document.getElementById("date-modal").classList.add("active");
          document.getElementById("fridge-selector").style.display = "none";
        } else {
          alert("‚ùå –ü–æ–º–∏–ª–∫–∞: " + result.error);
        }
      } catch (error) {
        alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: " + error.message);
      }
    }
  </script>
</body>
</html>
