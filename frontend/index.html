<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      font-size: 2em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    /* –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ */
    #fridge-selector {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .fridge-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .fridge-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .fridge-card.selected {
      background: #667eea;
      color: white;
    }
    
    .fridge-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }
    
    .fridge-number {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .fridge-count {
      font-size: 0.9em;
      opacity: 0.7;
    }
    
    /* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ */
    #product-list {
      display: none;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    #product-list.active {
      display: block;
    }
    
    .back-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      margin-bottom: 20px;
      transition: background 0.3s;
    }
    
    .back-btn:hover {
      background: #5568d3;
    }
    
    .product-item {
      border-bottom: 1px solid #eee;
      padding: 20px 0;
      display: grid;
      grid-template-columns: 1fr auto 150px;
      gap: 20px;
      align-items: center;
    }
    
    .product-item:last-child {
      border-bottom: none;
    }
    
    .product-info h3 {
      font-size: 1.1em;
      margin-bottom: 5px;
      color: #333;
    }
    
    .product-info .category {
      font-size: 0.9em;
      color: #666;
      background: #f0f0f0;
      display: inline-block;
      padding: 3px 10px;
      border-radius: 5px;
      margin-right: 10px;
    }
    
    .product-info .type {
      font-size: 0.9em;
      color: #667eea;
      font-weight: 500;
    }
    
    .current-quantity {
      text-align: right;
      font-size: 0.9em;
      color: #666;
    }
    
    .quantity-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quantity-input input {
      width: 100px;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      text-align: center;
    }
    
    .quantity-input input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .quantity-input span {
      color: #666;
      font-size: 0.9em;
    }
    
    .save-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 30px;
      width: 100%;
      transition: background 0.3s;
    }
    
    .save-btn:hover {
      background: #059669;
    }
    
    .save-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* –ü—Ä–æ–≥—Ä–µ—Å */
    .progress-bar {
      background: #f0f0f0;
      height: 8px;
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #667eea, #764ba2);
      height: 100%;
      transition: width 0.3s;
    }
    
    .message {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
      font-weight: 500;
    }
    
    .message.success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .message.error {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: white;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ùÑÔ∏è –Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤</h1>
    
    <div id="loading" class="loading">
      –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
    </div>
    
    <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ -->
    <div id="fridge-selector" style="display: none;"></div>
    
    <!-- –ï–∫—Ä–∞–Ω —Å–ø–∏—Å–∫—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ -->
    <div id="product-list">
      <button class="back-btn" onclick="showFridgeSelector()">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤</button>
      <h2 id="current-fridge-title"></h2>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div id="message"></div>
      <div id="products-container"></div>
      <button class="save-btn" onclick="saveCurrentFridge()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–ª–∏—à–∫–∏</button>
    </div>
  </div>

  <script>
    const API_URL = "https://inventory-duab.onrender.com";
    let allFridges = [];
    let currentFridge = null;
    let inventoryData = {}; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    async function loadData() {
      try {
        const response = await fetch(`${API_URL}/api/inventory/products`);
        const data = await response.json();
        
        allFridges = data;
        
        document.getElementById("loading").style.display = "none";
        showFridgeSelector();
      } catch (error) {
        document.getElementById("loading").innerHTML = 
          `<div class="message error">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${error.message}</div>`;
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –µ–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—ñ–≤
    function showFridgeSelector() {
      document.getElementById("fridge-selector").style.display = "grid";
      document.getElementById("product-list").classList.remove("active");
      
      const selector = document.getElementById("fridge-selector");
      selector.innerHTML = "";
      
      allFridges.forEach(fridge => {
        const card = document.createElement("div");
        card.className = "fridge-card";
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
        const hasData = inventoryData[fridge.fridgeNumber] && 
                        inventoryData[fridge.fridgeNumber].some(p => p.quantity > 0);
        
        if (hasData) {
          card.classList.add("selected");
        }
        
        card.innerHTML = `
          <div class="fridge-icon">‚ùÑÔ∏è</div>
          <div class="fridge-number">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ${fridge.fridgeNumber}</div>
          <div class="fridge-count">${fridge.products.length} –ø–æ–∑–∏—Ü—ñ–π</div>
          ${hasData ? '<div style="margin-top: 10px;">‚úÖ –ó–∞–ø–æ–≤–Ω–µ–Ω–æ</div>' : ''}
        `;
        
        card.onclick = () => showProducts(fridge);
        selector.appendChild(card);
      });
      
      // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É "–ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å–µ"
      if (Object.keys(inventoryData).length > 0) {
        const saveAllBtn = document.createElement("button");
        saveAllBtn.className = "save-btn";
        saveAllBtn.textContent = "üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –∑–∞–ª–∏—à–∫–∏ –≤ Google Sheets";
        saveAllBtn.style.gridColumn = "1 / -1";
        saveAllBtn.onclick = saveAllInventory;
        selector.appendChild(saveAllBtn);
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
    function showProducts(fridge) {
      currentFridge = fridge;
      document.getElementById("fridge-selector").style.display = "none";
      document.getElementById("product-list").classList.add("active");
      document.getElementById("current-fridge-title").textContent = 
        `–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ${fridge.fridgeNumber}`;
      
      const container = document.getElementById("products-container");
      container.innerHTML = "";
      
      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ —è–∫—â–æ —î
      const savedData = inventoryData[fridge.fridgeNumber] || [];
      
      fridge.products.forEach((product, index) => {
        const savedProduct = savedData.find(p => p.name === product.name);
        const quantity = savedProduct ? savedProduct.quantity : "";
        
        const item = document.createElement("div");
        item.className = "product-item";
        item.innerHTML = `
          <div class="product-info">
            <h3>${product.name}</h3>
            <span class="category">${product.category}</span>
            <span class="type">${product.type}</span>
          </div>
          <div class="current-quantity">
            ${product.currentQuantity ? `–ü–æ—Ç–æ—á–Ω–∏–π: ${product.currentQuantity}` : ''}
          </div>
          <div class="quantity-input">
            <input 
              type="number" 
              step="0.01" 
              min="0" 
              placeholder="0"
              value="${quantity}"
              data-product-name="${product.name}"
              oninput="updateProgress()"
            />
            <span>–∫–≥</span>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateProgress();
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
    function updateProgress() {
      const inputs = document.querySelectorAll("#products-container input");
      const filled = Array.from(inputs).filter(input => input.value !== "").length;
      const total = inputs.length;
      const percent = (filled / total) * 100;
      
      document.getElementById("progress-fill").style.width = percent + "%";
    }

    // –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
    function saveCurrentFridge() {
      const inputs = document.querySelectorAll("#products-container input");
      const products = [];
      
      inputs.forEach(input => {
        const quantity = parseFloat(input.value) || 0;
        products.push({
          name: input.getAttribute("data-product-name"),
          quantity: quantity
        });
      });
      
      inventoryData[currentFridge.fridgeNumber] = products;
      
      const messageDiv = document.getElementById("message");
      messageDiv.className = "message success";
      messageDiv.textContent = "‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –ú–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ –∞–±–æ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤—Å–µ.";
      
      setTimeout(() => {
        showFridgeSelector();
      }, 1500);
    }

    // –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ –≤ Google Sheets
    async function saveAllInventory() {
      try {
        const fridgeArray = Object.keys(inventoryData).map(fridgeNumber => ({
          fridgeNumber,
          products: inventoryData[fridgeNumber]
        }));
        
        const response = await fetch(`${API_URL}/api/inventory/save`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ inventoryData: fridgeArray })
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert("‚úÖ " + result.message);
          // –û—á–∏—â–∞—î–º–æ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
          inventoryData = {};
          loadData(); // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ
        } else {
          alert("‚ùå –ü–æ–º–∏–ª–∫–∞: " + result.error);
        }
      } catch (error) {
        alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: " + error.message);
      }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    loadData();
  </script>
</body>
</html>
